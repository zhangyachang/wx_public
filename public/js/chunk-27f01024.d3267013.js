(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27f01024"],{"3fe1":function(e,t,a){},"50d7b":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"c_power"},[a("CContentHeader",{attrs:{isShowIcon:!1,content:"权限管理"},on:{back:e.click}}),a("div",{staticClass:"c_tab"},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"角色管理",name:"first"}},[a("div",{staticClass:"c_tab_table"},[a("router-link",{staticClass:"c_tab_table_button",attrs:{to:"/powerCreateRoles"}},[a("i",{staticClass:"el-icon-plus"}),e._v(" 新建角色\n                    ")]),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.roleList}},[a("el-table-column",{attrs:{width:"450",prop:"_name",label:"名称"}}),a("el-table-column",{attrs:{"min-width":"230",prop:"alias",label:"别名"}}),a("el-table-column",{attrs:{width:"250",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"c_scope_but_configure",attrs:{type:"primary",plain:""},on:{click:function(a){return e.dialog(t.row)}}},[e._v("权限配置")]),a("el-button",{staticClass:"c_scope_but_revise",attrs:{type:"text",size:"small"},on:{click:function(a){return e.roleRevise(t.row)}}},[e._v("修改")]),a("el-button",{staticClass:"c_scope_but_delete",attrs:{type:"text",size:"small"},on:{click:function(a){return e.roleDelete(t.row,t.$index)}}},[e._v("删除")])]}}])})],1),a("div",{staticClass:"c_pagination"},[a("div",{staticClass:"c_pagination_text"},[e._v("\n                            共"),a("span",[e._v(e._s(e.pageCount))]),e._v("页\n                        ")]),a("div",{staticClass:"c_pagination_but"},[a("el-pagination",{attrs:{"current-page":e.pageIndex,"page-size":e.pageSize,layout:"prev, pager, next, jumper",total:e.pageTotal},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.pageIndex=t},"update:current-page":function(t){e.pageIndex=t}}})],1)])],1)])],1)],1),a("div",{staticClass:"c_elastic_frame"},[e.dialogShow?a("MaskLayer",{attrs:{title:"权限管理",twoTitle:"用户将拥有以下权限",dialogShow:e.dialogShow,powerList:e.powerList},on:{"update:dialogShow":function(t){e.dialogShow=t},"update:dialog-show":function(t){e.dialogShow=t},submit:e.submitBtn,reset:e.resetBtn}}):e._e()],1)],1)},n=[],i=(a("7f7f"),a("96cf"),a("3b8d")),o=a("778c"),r={data:function(){return{activeName:"first",roleList:[{_name:"王小虎",alias:"root"},{_name:"王小虎",alias:"root"},{_name:"王小虎",alias:"root"},{_name:"王小虎",alias:"root"},{_name:"王小虎",alias:"root"},{_name:"王小虎",alias:"root"},{_name:"王小虎",alias:"root"},{_name:"王小虎",alias:"root"},{_name:"王小虎",alias:"root"},{_name:"王小虎",alias:"root"}],pageIndex:1,pageSize:10,pageTotal:100,pageCount:10,dialogShow:!1,powerList:[],role_id:"",company_id:"cp_001",user_id:"user_001"}},methods:{submitBtn:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var a,s,n,i,o,r,l,c;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.dialogShow=!1,console.log("接收到了"),console.log(t),a={statusCode:75500},t.deleteList.length>0&&(console.log("1111"),s=t.deleteList,n=!0,i=this.extract(s,n),a=this.unbindRoleOfTeamsAndUsers(i)),!(!t.selectList.length>0)){e.next=8;break}return 75200===a.statusCode?this.$zero.ToastSuccess("修改权限成功"):this.$zero.ToastWarning("服务异常，请稍后再试"),e.abrupt("return");case 8:if(o=t.selectList,r=this.extract(o),l={statusCode:75500},c={statusCode:75500},!(r.teamList.length>0)){e.next=16;break}return e.next=15,this.$api.authorized.addTeamandrole({company_id:this.company_id,teams:r.teamList,role_id:this.role_id});case 15:l=e.sent;case 16:if(!(r.userList.length>0)){e.next=20;break}return e.next=19,this.$api.authorized.addUserandrole({company_id:this.company_id,users:r.userList,role_id:this.role_id});case 19:c=e.sent;case 20:console.log(l),console.log(c),75200==l.statusCode||75200==c.statusCode?this.$zero.ToastSuccess("修改权限成功"):this.$zero.ToastWarning("服务异常，请稍后再试");case 23:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),extract:function(e,t){for(var a=[],s=[],n=0,i=0,o=0;o<e.length;o++)"dep"==e[o].type?(t?a.push(e[o].depid):a[n]={id:e[o].depid,name:e[o].name},n++):(t?s.push(e[o].depid):s[i]={id:e[o].depid,name:e[o].name},i++);return{teamList:a,userList:s}},resetBtn:function(){this.dialogShow=!1},click:function(){},handleClick:function(e,t){console.log(111),console.log(e,t)},roleRevise:function(e){console.log("修改成功。。。"),console.log(e),this.$router.push({name:"powerCreateRoles",params:{id:e._id}})},roleDelete:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t,a){var s,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("删除成功。。。"),console.log(t),console.log(a),e.next=5,this.$zero.DeleteTips("此操作将永久删除该角色, 是否继续?");case 5:if(s=e.sent,console.log(s),!s){e.next=12;break}return e.next=10,this.$api.authorized.deleteRole({company_id:this.company_id,user_id:this.user_id,role_id:t._id});case 10:n=e.sent,75200===n.statusCode?(this.roleList,this.$message({type:"success",message:"删除成功!"}),this.roleList.splice(a,1),0==this.roleList.length&&1!=this.pageIndex&&(console.log("我进来没"),this.pageIndex--),this.getRole()):this.$zero.ToastWarning(n.msg);case 12:case"end":return e.stop()}},e,this)}));function t(t,a){return e.apply(this,arguments)}return t}(),handleCurrentChange:function(e){this.pageIndex=e,this.getRole(),console.log("当前页: ".concat(e))},dialog:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var a,s,n,i,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return this.dialogShow=!0,console.log(t),this.role_id=t._id,a=[],e.next=6,this.$api.authorized.getRolePower({company_id:this.company_id,user_id:this.user_id,role_id:this.role_id});case 6:for(s=e.sent,n=0;n<s.teams.length;n++)s.teams[n].type="dep";for(i=0;i<s.users.length;i++)s.users[i].type="user";for(a=s.teams.concat(s.users),o=0;o<a.length;o++)"dep"===a[o].type?(a[o].name=a[o].team_name,a[o].depid=a[o].team_id):(a[o].name=a[o].user_name,a[o].depid=a[o].user_id);console.log(a),this.powerList=JSON.parse(JSON.stringify(a));case 13:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),getRole:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.authorized.getRole({company_id:this.company_id,user_id:this.user_id,pageIndex:this.pageIndex,pageSize:this.pageSize});case 2:t=e.sent,75200===t.statusCode?(this.pageTotal=t.total,this.pageCount=Math.ceil(this.pageTotal/this.pageSize),this.roleList=t.roles,this.scrollBar()):(t.statusCode,this.$zero.ToastWarning("服务异常，请稍后再试"));case 4:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),unbindRoleOfTeamsAndUsers:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var a;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$api.authorized.unbindRoleOfTeamsAndUsers({company_id:this.company_id,user_id:this.user_id,role_id:this.role_id,users:t.userList,teams:t.teamList});case 2:return a=e.sent,e.abrupt("return",a);case 4:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),scrollBar:function(){$(".el-table__body-wrapper").getNiceScroll().remove(),$(".el-table__body-wrapper").niceScroll(".el-table__body",{cursorcolor:"#2f78ef",cursorwidth:"5px",autohidemode:!1,background:"#e6e6e6",preventmultitouchscrolling:!0,bouncescroll:!1})}},mounted:function(){this.getRole()},beforeDestroy:function(){this.$zero.eventBus.$off("addBookLoadMore"),this.$zero.eventBus.$off("departmentItem")},components:{MaskLayer:o["a"]}},l=r,c=(a("d4f2"),a("2877")),u=Object(c["a"])(l,s,n,!1,null,null,null);t["default"]=u.exports},d4f2:function(e,t,a){"use strict";var s=a("3fe1"),n=a.n(s);n.a}}]);
//# sourceMappingURL=chunk-27f01024.d3267013.js.map