(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-55b09aac"],{"0d48":function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"add_new_app"},[n("CContentHeader",{attrs:{content:"新建IOS应用",isShowIcon:!0}}),e.isHavaApp?e._e():n("div",{staticClass:"ana-cover-wrap"},[n("uploadApp",{attrs:{type:"ipa"},on:{appFile:e.uploadFile}})],1),e.isHavaApp?n("div",{staticClass:"ana_content"},[n("div",{staticClass:"ana_content_wrap"},[n("AppInfo",{attrs:{inputmodel:e.uploadInfo.analysis_con}}),n("AppVersion",{attrs:{appinfo:e.uploadInfo.analysis_con}}),n("viewRange",{on:{allow_ranges:e.allow_ranges}}),n("AppPreviewImg",{attrs:{previews:e.uploadInfo.previews}}),n("selectLocation",{attrs:{radio:e.uploadInfo}}),n("AppAddBtn",{on:{add:e.addBtn}})],1)]):e._e(),n("div",{staticClass:"ana_loadding"})],1)},a=[],i=(n("96cf"),n("3b8d")),s=(n("7f7f"),n("1d40")),r=n("1b5b"),l=n("eb9f"),c=n("1480"),u=n("8118"),p=n("3382"),d=n("e65e"),f=n("15c6"),h=n.n(f),g=n("b1f8"),m=n("5118"),v={mixins:[g["a"]],data:function(){return{isHavaApp:!1,appFile:null,appInfoParser:{},uploadInfo:{analysis_con:{},previews:[],typeid:"",allow_ranges:[]},middleFilesResult:{storage_url:"",source_name:"",logoUrl:"",previews:[]}}},methods:{allow_ranges:function(e){var t;console.log("这里拿到选择的东西"),console.log(e);for(var n=0,o=e.length;n<o;n++){t=e[n];var a={};"dep"===t.type?(a.type="dep",a.dep=t._id):"user"===t.type?(a.type="user",a.user=t._id):(a.type="dep",a.dep=t._id),a.name=t.name,this.uploadInfo.allow_ranges.push(a)}},uploadFile:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(t){var n,o;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("上传应用包之后"),console.log(t),this.appFile=t,n=new h.a(t[0]),e.next=6,n.parse();case 6:o=e.sent,console.log("分析结果"),console.log(o),console.log("打印json"),console.log(JSON.stringify(o)),this.appInfoParser=o,this.uploadInfo.version=o["versionName"]||o["CFBundleShortVersionString"],this.uploadInfo.size=(this.appFile[0].size/1024/1024).toFixed(2),this.uploadInfo.icon=o.icon,this.uploadInfo.analysis_con={packageName:o["package"]||o["CFBundleIdentifier"]||o["CFBundleName"],appName:o["CFBundleDisplayName"],version:o["versionName"]||o["CFBundleShortVersionString"],icon:o.icon,size:(this.appFile[0].size/1024/1024).toFixed(2),build:o.CFBundleVersion},console.log("解析包内容"),console.log(this.uploadInfo),this.isHavaApp=!0;case 19:case"end":return e.stop()}},e,this)}));function t(t){return e.apply(this,arguments)}return t}(),uploadLogo:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(this.loadding=this.$zero.wholeLoadding({text:"上传logo中..."}),void 0!==this.uploadInfo.analysis_con.isBase64){e.next=7;break}return e.next=4,this.mixinBase64toUrl(this.uploadInfo.analysis_con.icon);case 4:t=e.sent,e.next=10;break;case 7:return e.next=9,this.mixinUploadImg([this.uploadInfo.analysis_con.imgFile]);case 9:t=e.sent;case 10:if(this.loadding.close(),t){e.next=13;break}return e.abrupt("return",console.log("logo上传出错了"));case 13:console.log("url路径地址"),console.log(t),this.middleFilesResult.logoUrl=t[0].server_name,this.createApp();case 17:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),uploadPreviewImg:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,n;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(console.log("获取到的图片列表"),console.log(this.uploadInfo.previews.files),e.prev=2,this.uploadInfo.previews.files&&0!==this.uploadInfo.previews.files.length){e.next=7;break}return this.$zero.ToastWarning("没有预览图片"),this.uploadLogo(),e.abrupt("return");case 7:return this.loadding=this.$zero.wholeLoadding({text:"上传预览图中.."}),e.next=10,this.mixinUploadImg(this.uploadInfo.previews.files);case 10:if(t=e.sent,this.loadding.close(),this.uploadLogo(),console.log("上传预览图结果"),console.log(t),t){e.next=17;break}return e.abrupt("return");case 17:for(n=0;n<t.length;n++)this.middleFilesResult.previews.push(t[n].server_name);e.next=24;break;case 20:e.prev=20,e.t0=e["catch"](2),console.log("执行过程出错了"),console.log(e.t0);case 24:case"end":return e.stop()}},e,this,[[2,20]])}));function t(){return e.apply(this,arguments)}return t}(),createApp:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t,n,o,a=this;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("创建app应用"),console.log("上传的什么东西"),console.log(this.uploadInfo),console.log("应用的链接"),console.log(this.middleFilesResult),t=this.$zero.getCompany_id(),n=this.$zero.getUserid(),console.log("创建应用接口调用"),this.loadding=this.$zero.wholeLoadding({text:"上传应用信息..."}),console.log("上传应用包信息"),e.next=12,this.$api.application.createIOS({company_id:t,_name:this.uploadInfo.analysis_con.appName,typeid:this.uploadInfo.typeid,icon:this.middleFilesResult.logoUrl,description:this.uploadInfo.analysis_con.appDes,founder:n,allow_ranges:this.uploadInfo.allow_ranges,manages:[n],agentid:this.uploadInfo.analysis_con.packageName,build:"build "+this.uploadInfo.analysis_con.build,storage_url:this.middleFilesResult.storage_url,source_name:this.middleFilesResult.source_name,version:this.uploadInfo.analysis_con.version,size:this.uploadInfo.analysis_con.size+"M",previews:this.middleFilesResult.previews,package_type:""});case 12:if(o=e.sent,this.loadding.close(),console.log("上传结果"),console.log(o),75500!==o.statusCode){e.next=18;break}return e.abrupt("return",this.$zero.notify({title:"应用创建失败",message:"服务繁忙，上传失败，请稍后再试",duration:0}));case 18:if(75200===o.statusCode||75201===o.statusCode){e.next=20;break}return e.abrupt("return",this.$zero.notify({title:"应用创建失败",message:"应用创建失败，错误码:".concat(o.statusCode),duration:0}));case 20:this.$zero.notify({title:"应用创建成功",message:"新建了一个Ios应用，可在控制台查看",duration:0}),Object(m["setTimeout"])(function(){a.$router.go(-1)},2e3);case 22:case"end":return e.stop()}},e,this)}));function t(){return e.apply(this,arguments)}return t}(),addBtn:function(){var e=Object(i["a"])(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:return console.log("点击了创建应用按钮"),e.prev=1,this.loadding=this.$zero.wholeLoadding({text:"上传应用包中..."}),e.next=5,this.mixinUploadApp2url(this.appFile[0]);case 5:if(t=e.sent,this.loadding.close(),t){e.next=9;break}return e.abrupt("return",console.log("上传文件就出错了！"));case 9:return this.middleFilesResult.storage_url=t.server_name,this.middleFilesResult.source_name=t.upload_name,e.next=13,this.uploadPreviewImg();case 13:e.next=19;break;case 15:e.prev=15,e.t0=e["catch"](1),console.log("执行过程出错了"),console.log(e.t0);case 19:case"end":return e.stop()}},e,this,[[1,15]])}));function t(){return e.apply(this,arguments)}return t}()},created:function(){this.$route.params.file&&this.uploadFile(this.$route.params.file)},components:{AppInfo:s["a"],AppVersion:r["a"],AppPreviewImg:l["a"],AppAddBtn:c["a"],uploadApp:u["a"],selectLocation:p["a"],viewRange:d["a"]}},_=v,w=(n("f9a3"),n("2877")),I=Object(w["a"])(_,o,a,!1,null,null,null);t["default"]=I.exports},5118:function(e,t,n){(function(e){var o="undefined"!==typeof e&&e||"undefined"!==typeof self&&self||window,a=Function.prototype.apply;function i(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new i(a.call(setTimeout,o,arguments),clearTimeout)},t.setInterval=function(){return new i(a.call(setInterval,o,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},i.prototype.unref=i.prototype.ref=function(){},i.prototype.close=function(){this._clearFn.call(o,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n("6017"),t.setImmediate="undefined"!==typeof self&&self.setImmediate||"undefined"!==typeof e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!==typeof self&&self.clearImmediate||"undefined"!==typeof e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n("c8ba"))},6017:function(e,t,n){(function(e,t){(function(e,n){"use strict";if(!e.setImmediate){var o,a=1,i={},s=!1,r=e.document,l=Object.getPrototypeOf&&Object.getPrototypeOf(e);l=l&&l.setTimeout?l:e,"[object process]"==={}.toString.call(e.process)?f():h()?g():e.MessageChannel?m():r&&"onreadystatechange"in r.createElement("script")?v():_(),l.setImmediate=c,l.clearImmediate=u}function c(e){"function"!==typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var s={callback:e,args:t};return i[a]=s,o(a),a++}function u(e){delete i[e]}function p(e){var t=e.callback,o=e.args;switch(o.length){case 0:t();break;case 1:t(o[0]);break;case 2:t(o[0],o[1]);break;case 3:t(o[0],o[1],o[2]);break;default:t.apply(n,o);break}}function d(e){if(s)setTimeout(d,0,e);else{var t=i[e];if(t){s=!0;try{p(t)}finally{u(e),s=!1}}}}function f(){o=function(e){t.nextTick(function(){d(e)})}}function h(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function g(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"===typeof n.data&&0===n.data.indexOf(t)&&d(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),o=function(n){e.postMessage(t+n,"*")}}function m(){var e=new MessageChannel;e.port1.onmessage=function(e){var t=e.data;d(t)},o=function(t){e.port2.postMessage(t)}}function v(){var e=r.documentElement;o=function(t){var n=r.createElement("script");n.onreadystatechange=function(){d(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}function _(){o=function(e){setTimeout(d,0,e)}}})("undefined"===typeof self?"undefined"===typeof e?this:e:self)}).call(this,n("c8ba"),n("f28c"))},f6e2:function(e,t,n){},f9a3:function(e,t,n){"use strict";var o=n("f6e2"),a=n.n(o);a.a}}]);
//# sourceMappingURL=chunk-55b09aac.10f36e8c.js.map